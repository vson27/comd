%{
#include <stdio.h>
#include <string.h>

int line_count = 1;
int word_count = 0;
int char_count = 0;

/* Keyword list */
char *keywords[] = {
    "int", "float", "char", "double", "if", "else", "while",
    "for", "return", "void", "main", "include"
};

int isKeyword(char *word) {
    for (int i = 0; i < sizeof(keywords)/sizeof(keywords[0]); i++)
        if (strcmp(word, keywords[i]) == 0)
            return 1;
    return 0;
}
%}

/* Definitions */
Digit      [0-9]
Letter     [A-Za-z_]
Identifier {Letter}({Letter}|{Digit})*
Integer    {Digit}+
Float      {Digit}+"."{Digit}+
Whitespace [ \t]+
Newline    \n
Operator   [+\-*/=<>!]+
Special    [;:,(){}[\]]

%%

/* Comments */
"//".*                { /* ignore single-line comment */ }
"/*"([^*]|\*+[^*/])*\*+"/"   { /* ignore multi-line comment */ }

/* Keywords & Identifiers */
{Identifier} {
    char_count += yyleng;
    word_count++;
    if (isKeyword(yytext))
        printf("<KEYWORD, %s>\n", yytext);
    else
        printf("<IDENTIFIER, %s>\n", yytext);
}

/* Numbers */
{Float} {
    char_count += yyleng;
    word_count++;
    printf("<FLOAT, %s>\n", yytext);
}

{Integer} {
    char_count += yyleng;
    word_count++;
    printf("<INTEGER, %s>\n", yytext);
}

/* Operators */
{Operator} {
    char_count += yyleng;
    printf("<OPERATOR, %s>\n", yytext);
}

/* Special symbols */
{Special} {
    char_count += yyleng;
    printf("<SPECIAL, %s>\n", yytext);
}

/* Whitespace handling */
{Whitespace} { char_count += yyleng; }

/* Count newlines */
{Newline} { line_count++; char_count += yyleng; }

/* Anything else */
. {
    char_count += yyleng;
    printf("<UNKNOWN, %s>\n", yytext);
}

%%

int main() {
    yylex();
    printf("\n=== SUMMARY ===\n");
    printf("Lines      : %d\n", line_count);
    printf("Words      : %d\n", word_count);
    printf("Characters : %d\n", char_count);
    return 0;
}

int yywrap() {
    return 1;
}
